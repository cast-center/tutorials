---
title: "OncoSig: Oncoprotein-specific molecular interaction maps"
author: 
 - "Columbia U54 Center for Cancer Systems Therapeutics (CaST)"
date: "June 10, 2024"
output:
  html_document:
    toc: true
    toc_float: true
    theme: "spacelab"
    code_folding: "show"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## OncoSig Introduction

[**OncoSig**](https://pubmed.ncbi.nlm.nih.gov/32929263/) is a supervised Machine Learning algorithm for constructing molecular-interaction Signaling Maps (*SigMaps*) for an oncoprotein specific for a given tumor type. OncoSig integrates features from PrePPI and protein-protein interactions (PPIs) inferred from genomics data from, for example, patient samples with lung adenocarcinoma, by reverse engineering algorithms. A SigMap for KRAS recapitulated published KRAS biology and identified novel proteins synthetic lethal with mutant KRAS, 18 of 21 of which were validated in 3D spheroid models for LUAD. The KRAS LUAD SigMap consists of established and novel K-Ras pathway members and is enriched in known targets of FDA approved drugs. 


In this example script, we create a SigMap for the oncoprotein KRAS using a reduced-size version of a network file generated by processing lung adenocarcinoma (LUAD) samples, from the Genome Cancer Atlas project (TCGA). The companion Docker container includes the full version of the network, as well as a network generated from the TCGA colon adenocarcinoma (COAD) sample collection. In addition, information is provided for creating SigMaps for nine other oncoproteins: CDKN2A, EGFR, MAPK, NTRK3, PI3K, TP53, STK11, YAP1 and CTNNB1. Details about how the networks are generated can be found in the OncoSig publication. 

---

## OncoSig Setup


### Libraries 

Load the required libraries.

```{r,warnings=FALSE}
if(!require("randomForest", quietly = TRUE)) {
  install.packages("randomForest")
  require(randomForest, quietly = TRUE)
}
if(!require("ROCR", quietly = TRUE)) {
  install.packages("ROCR")
  require(ROCR, quietly = TRUE)
}
```


### Environment

Set the working directory, where the example code and data files are located.

```{r}
setwd("/usr/local/")
```


### Code

Source the code needed to run the OncoSig algorithm. 

```{r}
source("./R/listToMatrix.R")
source("./R/OncoSigRF.R")
```

---

## OncoSig data

Set the network file path and read in the network file.  

```{r}
Network_location <- "./Data_files/luad_network_sample.txt"
Network <- read.delim(Network_location, header = F)
```


### OncoSig network

The network is comprised of human protein-protein interactions (PPIs) based on difference evidence types. Inspect several entries:

```{r}
Network[sample(1:nrow(Network),10),]
```


The entries of `Network` are of the form: 
       UniProt1_Feature     UniProt2     Feature_value

The first two columns contain UniProt identifiers for the interacting proteins, e.g. KRAS would be denoted as P01116. The "Feature" term appended to the first UniProt ID gives the type of evidence, and the third column provides the predicted interaction strength. A given PPI (UniProt1-UniProt2) may have one or more of the following evidence types (features) with the respective values:
-PREPPI likelhood ratio
-ARACNE mutual information
-VIPER negative log p-value
-CINDY Number of statistically significant triplets

See the [OncoSig publication](https://pubmed.ncbi.nlm.nih.gov/32929263/) for more detail.


**Random forest** is a tree-based model and does not require feature scaling. Additional features may be included by modifying the network file.


The network file gets converted to a numerical matrix. 

```{r}
Network$V1 <- as.character(Network$V1)
Network$V2 <- as.character(Network$V2)
Network$V3 <- as.numeric(Network$V3)
Network <- as.matrix(Network)
Network[, 3] <- as.numeric(Network[, 3])
Network_matrix <- listToMatrix(Network)
```



Rows and columns of `Network_matrix` correspond to proteins, and the entries are interaction scores. We can examine some of the feature values for KRAS:

```{r}
KRAS_features<-Network_matrix[row.names(Network_matrix)=="P01116",]
print(round(sample(KRAS_features[KRAS_features>0],20),2))
```


### Define the gold standard set

In this tutorial, the gold standard set comprises canonical KRAS signaling proteins compiled from the KEGG, Biocarta, and Reactome databases as delineated in the *Human MSigDB curated gene sets (C2) collection*. Gold standard sets for the nine other oncoproteins (CDKN2A, EGFR, MAPK, NTRK3, PI3K, TP53, STK11, YAP1 and CTNNB1) can be selected by modifying the file path and changing KRAS to the appropriate gene symbol. The KRAS gold standard set contains 250 proteins. The negative set corresponds to those proteins not in the gold standard set.

```{r}
Gold_Standard_location <- "./Data_files/10_oncogene_pathways/KRAS/gold_standard.txt"
Gold_Standard <- read.delim(Gold_Standard_location, header = F)
Gold_Standard$V1 <- as.character(Gold_Standard$V1)

length(Gold_Standard$V1)
head(Gold_Standard$V1)
```

---

## Running OncoSig

### Create the feature matrix for classification

The feature matrix is compiled by combining `Network_matrix` and `Gold_Standard`. A gold standard feature is created where proteins that are part of the gold standard set are assigned a value of 1 and all others proteins are assigned a value of 0.

```{r}
Network_matrix_df <- as.data.frame(Network_matrix)
Gold_Standard_in_Network_names <- intersect(rownames(Network_matrix_df), Gold_Standard$V1)
Negative_Set_names <- setdiff(rownames(Network_matrix_df), Gold_Standard_in_Network_names)
remove(Network_matrix)
```


### Run the random forest classifier

For the OncoSig publication, with the full feature matrix, the classifier was trained and tested with the oncoprotein's gold standard and negative sets using Monte Carlo cross-validation, creating 50 forests each with 50 trees. For this sample calculation, 10 trees and 10 iterations are sufficient. 

```{r}
Query_output_results <- OncoSigRF(Network_matrix_df, Gold_Standard_in_Network_names, Fraction_Gold_sample = 0.5, ntrees = 10, max_iterations = 10, balance = 1)
```



### Examine the output

```{r}
library("data.table")
Query_output_results_scores <- setorder(Query_output_results[[1]],-Score)
head(Query_output_results_scores,10)
```

Among the top-scoring KRAS LUAD-specific SigMap members are proteins in the gold standard set (PRKCB and PLCG2) and novel predictions (ARAP2 and STK11).



### Save the results

```{r}
result_dir <- "../result/"
if (!dir.exists(result_dir)) dir.create(result_dir, recursive = TRUE)
write.csv(Query_output_results_scores, paste0(result_dir, "results.csv"))
```

---

## OncoSig evaluation

### ROC curves

Calculate receiver operating characteristic (ROC) curves.  Save it to a PDF file by setting `save_to_file = TRUE`.

The full ROC curve:

```{r}
save_to_file = FALSE
if (save_to_file)
  pdf(file = paste0(result_dir, "KRAS_ROC.pdf"))
Query_output_results_scores <- Query_output_results[[1]]
Query_output_results_scores$label <- 0
Query_output_results_scores[Gold_Standard_in_Network_names, 2] <- 1
Query_output_results_scores <- na.omit(Query_output_results_scores)
pred <- prediction(Query_output_results_scores$Score, Query_output_results_scores$label)
perf <- performance(pred, measure = "tpr", x.measure = "fpr")
plot(perf, col = "black", xlim = c(0, 1), lwd = 4)
if (save_to_file)
  dev.off()
```


The ROC curve at low FPR < 0.05:

```{r}
if (save_to_file)
  pdf(file = paste0(result_dir, "KRAS_ROC_frp05.pdf"), height = 5, width = 5)
perf <- performance(pred, measure = "tpr", x.measure = "fpr")
plot(perf, col = "black", xlim = c(0, 0.05), lwd = 4)
if (save_to_file)
  dev.off()
```

---

## Summary

The term **pathway**, although widely used, is a loosely defined biological concept. SigMaps are a fundamentally different representation of the signaling and regulatory machinery necessary to modulate and affect the function of a specific protein of interest in a specific tissue context, which is equivalent to a proteinâ€™s mechanism of action.


OncoSig generates a single integrated score representing the probability that a protein belongs to a specific SigMap. Use of PrePPI is instrumental for identifying PPIs, whereas ARACNe, VIPER and CINDy provide critical tissue specificity and additional evidence supporting both physical and functional interactions. Taken together, these individual evidence sources can effectively place proteins within the conceptual molecular interaction architecture.

